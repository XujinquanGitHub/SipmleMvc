# 工单创建文档

### 1. 工单创建接口参数
#### 接口地址：
    http://ticketyewuapi.tuhu.work/api/WorkOrderApi/NewCreateTuhuWorkOrder
#### 接口参数
 ```json
 {"request":"{\"ApiControlRequest\":[],\"WorkOrderRequest\":{\"TaskEntity\":{\"DepartmentType\":\"门店\",\"TaskType\":\"门店\",\"TaskSubType1\":\"其他工单\",\"TaskSubType2\":\"\",\"TaskSubType3\":\"\",\"Concerner\":\"wanghuijie@tuhu.cn,zhoukeren@tuhu.cn\",\"DealResult\":\"测试\",\"TaskPriority\":\"一般\",\"CreateUser\":\"panzhang@tuhu.cn\",\"TaskOwner\":\"xujinquan@tuhu.cn\",\"flag\":0,\"OperationType\":0,\"TaskTitle\":\"测试\",\"TaskContent\":\"测试\",\"WorkOrderType\":0},\"UploadList\":[]}}"}
 ```
 ### 2. 流程图 

```flow
st=>start: Start
setChildrenControlValueModelByApiPostData=>operation: 将前端传入子模板值转换成数据库实体类
setControlValueModelByApiPostData=>operation: 将前端传入父模板值转换成数据库实体类
setCurrentProcessWhereCreate=>operation: 设置当前步骤（创建工单时为第一步）
setNextProcessWhereCreate=>operation: 设定下一步
separateOrderBefore=>condition: 判断是否需要分单?
setSeparateListFiled=>operation: 设置分单控件
createWorkOrderEntity=>operation: 创建工单实体
addInterfaceWhereCreateTask=>operation: 添加步骤实例
insertChildrenValue=>operation: 把子模板值插入到数据库
insertControlValue=>operation: 把父模板值插入到数据库
shouQianWorkOrderTaskUploadFile=>operation: 将上传附件的地址插入数据库
addWorkOrderLog=>operation: 添加日志
commonMessagePush=>operation: 推送消息
separateOrderAfter=>condition: 判断是否需要分单?
separateOrder=>operation: 分单处理
sendMqByProcessDirection=>operation: 推送MQ消息
e=>end

st->setChildrenControlValueModelByApiPostData->setControlValueModelByApiPostData->setCurrentProcessWhereCreate->setNextProcessWhereCreate->separateOrderBefore->setSeparateListFiled->createWorkOrderEntity->addInterfaceWhereCreateTask->insertChildrenValue->insertControlValue->shouQianWorkOrderTaskUploadFile->addWorkOrderLog->commonMessagePush->separateOrderAfter->separateOrder->sendMqByProcessDirection->e
separateOrderBefore(yes)->setSeparateListFiled
separateOrderBefore(no)->createWorkOrderEntity
separateOrderAfter(yes)->separateOrder
separateOrderAfter(no)->sendMqByProcessDirection
```
